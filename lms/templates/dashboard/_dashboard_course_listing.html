<%page args="course_overview, enrollment, show_courseware_link, cert_status, can_unenroll, credit_status, show_email_settings, course_mode_info, show_refund_option, is_paid_course, is_course_blocked, verification_status, course_requirements, dashboard_index, share_settings, course_program_info" expression_filter="h"/>

<%!
import urllib

from django.utils.translation import ugettext as _
from django.utils.translation import ungettext
from django.core.urlresolvers import reverse
from markupsafe import escape
from course_modes.models import CourseMode
from courseware.courses import get_course_about_section
from course_modes.helpers import enrollment_mode_display
from student.models import UserProfile
from student.helpers import (
  VERIFY_STATUS_NEED_TO_VERIFY,
  VERIFY_STATUS_SUBMITTED,
  VERIFY_STATUS_APPROVED,
  VERIFY_STATUS_MISSED_DEADLINE,
  VERIFY_STATUS_NEED_TO_REVERIFY,
  DISABLE_UNENROLL_CERT_STATES,
)
%>
<!-- GEOFFREY -->
<%
#import SSO test
import json
import requests
import hashlib
import datetime

now = datetime.datetime.now()

date = now.strftime("%d%m%Y")

api = 'uYUoVrzSEVityKwgNhHO'
partenaire = 'LIkptrpdXajmLaJTRHYF'
email = request.user.email
first_name = request.user.first_name
last_name = request.user.last_name
id_membre = UserProfile.objects.get(user_id=request.user.id).rpid
day = '08'
month = '09'
year = '2016'

crypt = hashlib.sha256(id_membre+api).hexdigest()

d = hashlib.sha256(date+api).hexdigest()

url = 'https://lms.vodeclic.com/api/sso?'

data_fr = 'partenaire='+partenaire+'&encrypted_id='+crypt+'&id='+id_membre+'&first_name='+first_name+'&last_name='+last_name+'&email='+email+'&d='+d+''

href_sso = url+data_fr
#fin import SSo
course_number = course_overview.number
course_org = course_overview.org


%>
<!-- GEOFFREY -->
<%
language = LANGUAGE_CODE

from opaque_keys.edx.locations import SlashSeparatedCourseKey
from courseware.courses import get_course_by_id
course_id = course_overview.id
lang = get_course_by_id(course_id).language
if lang == 'fr':
  lang = 'FRA'
elif lang == 'en':
  lang = 'ENG'
endif
%>
<%
  cert_name_short = course_overview.cert_name_short
  if cert_name_short == "":
    cert_name_short = settings.CERT_NAME_SHORT

  cert_name_long = course_overview.cert_name_long
  if cert_name_long == "":
    cert_name_long = settings.CERT_NAME_LONG
  billing_email = settings.PAYMENT_SUPPORT_EMAIL
  vodeclicImage = ''
  imageVodeclick = 'imageVodeclick'
  noImageVodeclick = 'course-image'
%>

<%namespace name='static' file='../static_content.html'/>
<% style_overrides_file = static.get_value('css_overrides_file') %>
<style>
@media(max-width:800px) {
  .dashboard .my-courses .course .details .enter-course {
    width: 200px;
  }
}

</style>
<li class="course-item">

<script>
function articleHeight(){
  $('.course-info').each(function(){
    var doc = parseInt($(document).width());
    var cible = parseInt($(this).height());
    if(doc < 595 && $(this).css('display') != 'none' ) {
      if(cible <= 50) {
        $(this).parent().parent().css('height','430px');
      }else {
        $(this).parent().parent().css('height','520px');
      }
    }else{
      $(this).parent().parent().attr('style','');
    }
  })
}
function lienHeightTitle(){
  $('.course-title').each(function(){
    if($(this).height() > 53 && $(this).height() <= 106) {
      $(this).find('a').css('line-height','30px');
    }else if($(this).height() > 106 && $(this).height() <= 159) {
      $(this).find('a').css('line-height','30px');
    }else if($(this).height() > 159 ) {
      $(this).find('a').css('line-height','20px');
    }else{
      $(this).find('a').attr('style','');
    }
  })
}
$(window).resize(function(){
  lienHeightTitle();
  articleHeight();
})
$(document).ready(function(){
  console.log('rpid : ${id_membre}')
  lienHeightTitle();
  articleHeight();
  $('.course-actions').each(function(){
        var Url = '${href_sso}'+'&vodeclic_id=';
        var num = $(this).data('number');
        var org = $(this).data('org');
       if(org == 'Vodeclic') {
        var Urls = Url+num;
        $(this).find('a').attr('href', Urls);
        $(this).find('a').attr('target', '_blank');
      }else{
        var Urls = $(this).attr('data-link');
        $(this).find('a').attr('href', Urls);
      }
  })

  $('.wrapper-course-image').each(function(){
        var Url = '${href_sso}'+'&vodeclic_id=';
        var num = $(this).data('number');
        var org = $(this).data('org');
       if(org == 'Vodeclic') {
        var Urls = Url+num;
        $(this).find('.dash-img').attr('href', Urls);
        $(this).find('a').attr('target', '_blank');
        /*
        $(this).find('.dash-img').children('img').css('width','120px');
        $(this).find('.dash-img').children('img').css('height','120px');
        $(this).find('.dash-img').children('img').css('margin-left','auto');
        $(this).find('.dash-img').children('img').css('margin-right','auto');
        */
      }else{
        var Urls = $(this).attr('data-link');
        $(this).find('.dash-img').attr('href', Urls);
      }
  })

})
</script>

  % if settings.FEATURES.get('ENABLE_VERIFIED_CERTIFICATES'):
    <%
        course_verified_certs = enrollment_mode_display(
            enrollment.mode,
            verification_status.get('status'),
            course_overview.id
        )
    %>
    <%
        mode_class = course_verified_certs.get('display_mode', '')
        if mode_class != '':
            mode_class = ' ' + mode_class ;
    %>
  % else:
    <% mode_class = '' %>
  % endif
<div class="course-container" data-id="${enrollment.course_id}">
 % if course_program_info and course_program_info.get('category')=='xseries':
  <div class="label-xseries-association">
    <i class="xseries-icon"></i>
    <p class="message-copy">${_("{category} Program Course").format(category=course_program_info['display_category'])}</p>
  </div>
 % endif
<article class="course${mode_class}">
  <%
    course_root = ('info', 'welcome',)[int(settings.FEATURES.get('TMA_ENABLE_COURSE_WELCOME_PAGE', False))]
    course_target = reverse(course_root, args=[unicode(course_overview.id)])
  %>
  <section class="details">
    <div class="wrapper-course-image" aria-hidden="true"  data-number="${course_number}" data-org="${course_org}">
      % if show_courseware_link:
        % if not is_course_blocked:
            <a href="${course_target}" data-course-key="${enrollment.course_id}" class="cover dash-img
            % if course_org == 'Vodeclic':
              imageVodeclick
            % else:
              noImageVodeclick
            % endif
            ">
              <div class="language">${lang}</div>
              <img src="${course_overview.course_image_url}" alt="${_('{course_number} {course_name} Home Page').format(course_number=course_overview.number, course_name=course_overview.display_name_with_default)}" style="
              "/>
            </a>
        % else:
            <a class="fade-cover dash-img
            % if course_org == 'Vodeclic':
              imageVodeclick
            % else:
              noImageVodeclick
            % endif
            ">
              <img src="${course_overview.course_image_url}"alt="${_('{course_number} {course_name} Cover Image').format(course_number=course_overview.number, course_name=course_overview.display_name_with_default)}"  style=""/>
            </a>
        % endif
      % else:
        <a class="cover dash-img
        % if course_org == 'Vodeclic':
          imageVodeclick
        % else:
          noImageVodeclick
        % endif
        ">
          <img src="${course_overview.course_image_url}" class="course-image" alt="${_('{course_number} {course_name} Cover Image').format(course_number=course_overview.number, course_name=course_overview.display_name_with_default)}"  style="
          ">
        </a>
      % endif
      % if settings.FEATURES.get('ENABLE_VERIFIED_CERTIFICATES') and course_verified_certs.get('display_mode') != 'audit':
        <span class="sts-enrollment" title="${course_verified_certs.get('enrollment_title')}">
          <span class="label">${_("Enrolled as: ")}</span>
          % if course_verified_certs.get('show_image'):
              <img class="deco-graphic" src="${static.url('images/verified-ribbon.png')}" alt="${course_verified_certs.get('image_alt')}" />
          % endif
          <div class="sts-enrollment-value">${course_verified_certs.get('enrollment_value')}</div>
        </span>
      % endif
      <!-- --->
      <!-- --->
      <!-- --->
      <!-- --->
      <!-- --->
      <!-- --->
      <div class="wrapper-action-more" data-course-key="${enrollment.course_id}"  id="social1-on">
        % if can_unenroll:
          <div class="actions-item" id="actions-item-unenroll-${dashboard_index}">
            <div class="social-sharing">
                <a href="mailto:?subject=PhilÃ©as - Suivez%20un%20cours%20en%20ligne%20avec%20Phileas&amp;body=Je%20viens%20de%20m'inscrire%20pour%20${course_overview.display_name_with_default}%20via%20http://ec2-52-29-194-206.eu-central-1.compute.amazonaws.com${course_target}" class="share">
                  <img src="/static/themes/phileastheming/images/icon_recommandation.png" style="width:16px; height: auto; float:left; margin-right: 5px;" />${_("Recommend this Course")}<span class="sr">${_("Envoyez par e-mail que vous etes inscrits a ce cours")}</span>
                </a>
            </div>
          % if is_paid_course and show_refund_option:
            % if not is_course_blocked:
            <a href="#unenroll-modal" class="action action-unenroll" rel="leanModal" data-course-id="${course_overview.id}" data-course-number="${course_overview.number}" data-course-name="${course_overview.display_name_with_default}" data-dashboard-index="${dashboard_index}"
               data-track-info="${_("Are you sure you want to unenroll from the purchased course %(course_name)s (%(course_number)s)?")}"
               data-refund-info="${_("You will be refunded the amount you paid.")}">
              <img src="/static/themes/phileastheming/images/icon_desinscription.png" style="width:16px; height: auto; float:left; margin-right: 5px"/> ${_("Unenroll")}
            </a>
            % else:
            <a class="action action-unenroll is-disabled" data-course-id="${course_overview.id}" data-course-number="${course_overview.number}" data-course-name="${course_overview.display_name_with_default}" data-dashboard-index="${dashboard_index}"
               data-track-info="${_("Are you sure you want to unenroll from the purchased course %(course_name)s (%(course_number)s)?")}"
               data-refund-info="${_("You will be refunded the amount you paid.")}"><img src="/static/themes/phileastheming/images/icon_desinscription.png" style="width:16px; height: auto; float:left; margin-right: 5px"/>
              ${_("Unenroll")}
            </a>
            % endif
          % elif is_paid_course and not show_refund_option:
            % if not is_course_blocked:
            <a href="#unenroll-modal" class="action action-unenroll" rel="leanModal" data-course-id="${course_overview.id}" data-course-number="${course_overview.number}" data-course-name="${course_overview.display_name_with_default}" data-dashboard-index="${dashboard_index}"
               data-track-info="${_("Are you sure you want to unenroll from the purchased course %(course_name)s (%(course_number)s)?")}"
               data-refund-info="${_("You will not be refunded the amount you paid.")}"><img src="/static/themes/phileastheming/images/icon_desinscription.png" style="width:16px; height: auto; float:left; margin-right: 5px"/>
              ${_("Unenroll")}
            </a>
            % else:
            <a class="action action-unenroll is-disabled" data-course-id="${course_overview.id}" data-course-number="${course_overview.number}" data-course-name="${course_overview.display_name_with_default}" data-dashboard-index="${dashboard_index}"
               data-track-info="${_("Are you sure you want to unenroll from the purchased course %(course_name)s (%(course_number)s)?")}"
               data-refund-info="${_("You will not be refunded the amount you paid.")}"><img src="/static/themes/phileastheming/images/icon_desinscription.png" style="width:16px; height: auto; float:left; margin-right: 5px"/>
              ${_("Unenroll")}
            </a>
            % endif
          % elif enrollment.mode != "verified":
            % if not is_course_blocked:
            <a href="#unenroll-modal" class="action action-unenroll" rel="leanModal" data-course-id="${course_overview.id}" data-course-number="${course_overview.number}" data-course-name="${course_overview.display_name_with_default}" data-dashboard-index="${dashboard_index}"
               data-track-info="${_("Are you sure you want to unenroll from %(course_name)s (%(course_number)s)?")}"><img src="/static/themes/phileastheming/images/icon_desinscription.png" style="width:16px; height: auto; float:left; margin-right: 5px"/>
              ${_("Unenroll")}
            </a>
            % else:
            <a class="action action-unenroll is-disabled" data-course-id="${course_overview.id}" data-course-number="${course_overview.number}" data-course-name="${course_overview.display_name_with_default}" data-dashboard-index="${dashboard_index}"
               data-track-info="${_("Are you sure you want to unenroll from %(course_name)s (%(course_number)s)?")}"><img src="/static/themes/phileastheming/images/icon_desinscription.png" style="width:16px; height: auto; float:left; margin-right: 5px"/>
              ${_("Unenroll")}
            </a>
            % endif
          % elif show_refund_option:
            % if not is_course_blocked:
            <a href="#unenroll-modal" class="action action-unenroll" rel="leanModal" data-course-id="${course_overview.id}" data-course-number="${course_overview.number}" data-course-name="${course_overview.display_name_with_default}" data-dashboard-index="${dashboard_index}" data-cert-name-long="${cert_name_long}"
               data-track-info="${_("Are you sure you want to unenroll from the verified %(cert_name_long)s track of %(course_name)s (%(course_number)s)?")}"
               data-refund-info="${_("You will be refunded the amount you paid.")}"><img src="/static/themes/phileastheming/images/icon_desinscription.png" style="width:16px; height: auto; float:left; margin-right: 5px"/>
              ${_("Unenroll")}
            </a>
            % else:
            <a class="action action-unenroll is-disabled" data-course-id="${course_overview.id}" data-course-number="${course_overview.number}" data-course-name="${course_overview.display_name_with_default}" data-dashboard-index="${dashboard_index}" data-cert-name-long="${cert_name_long}"
               data-track-info="${_("Are you sure you want to unenroll from the verified %(cert_name_long)s track of %(course_name)s (%(course_number)s)?")}"
               data-refund-info="${_("You will be refunded the amount you paid.")}"><img src="/static/themes/phileastheming/images/icon_desinscription.png" style="width:16px; height: auto; float:left; margin-right: 5px"/>
              ${_("Unenroll")}
            </a>
            % endif
          % else:
            % if not is_course_blocked:
            <a href="#unenroll-modal" class="action action-unenroll" rel="leanModal" data-course-id="${course_overview.id}" data-course-number="${course_overview.number}" data-course-name="${course_overview.display_name_with_default}" data-dashboard-index="${dashboard_index}" data-cert-name-long="${cert_name_long}"
               data-track-info="${_("Are you sure you want to unenroll from the verified %(cert_name_long)s track of %(course_name)s (%(course_number)s)?")}"
               data-refund-info="${_("The refund deadline for this course has passed, so you will not receive a refund.")}"><img src="/static/themes/phileastheming/images/icon_desinscription.png" style="width:16px; height: auto; float:left; margin-right: 5px"/>
              ${_("Unenroll")}
            </a>
            % else:
            <a class="action action-unenroll is-disabled" data-course-id="${course_overview.id}" data-course-number="${course_overview.number}" data-course-name="${course_overview.display_name_with_default}" data-dashboard-index="${dashboard_index}" data-cert-name-long="${cert_name_long}"
               data-track-info="${_("Are you sure you want to unenroll from the verified %(cert_name_long)s track of %(course_name)s (%(course_number)s)?")}"
               data-refund-info="${_("The refund deadline for this course has passed, so you will not receive a refund.")}"><img src="/static/themes/phileastheming/images/icon_desinscription.png" style="width:16px; height: auto; float:left; margin-right: 5px"/>
              ${_("Unenroll")}
            </a>
            % endif
          % endif
        </div>
        % endif
        <div class="actions-item" id="actions-item-email-settings-${dashboard_index}">
          % if show_email_settings:
            % if not is_course_blocked:
              <a href="#email-settings-modal" class="action action-email-settings" rel="leanModal" data-course-id="${course_overview.id}" data-course-number="${course_overview.number}" data-dashboard-index="${dashboard_index}" data-optout="${unicode(course_overview.id) in course_optouts}">${_('Email Settings')}</a>
            % else:
              <a class="action action-email-settings is-disabled" data-course-id="${course_overview.id}" data-course-number="${course_overview.number}" data-dashboard-index="${dashboard_index}" data-optout="${unicode(course_overview.id) in course_optouts}">${_('Email Settings')}</a>
            % endif
          % endif
        </div>
      </div>
    </div>
    <!-- -->
      <div class="wrapper-course-details">
        <div class="course-info" id="course-info-pop1">
          <span class="info-date-block" data-tooltip="Hi">
            <img src="/static/themes/phileastheming/images/icon_calendar.png" />
            % if course_overview.display_org_with_default == "Vodeclic":
            ${_("Continuous formation")}
            % else:

              ${_(" - Start :")} <span class="start_end_date_time">${_(" {start_date}").format(start_date=course_overview.start_datetime_text("SHORT_DATE"))}
              </span>
                % if course_overview.end_datetime_text("SHORT_DATE") != '':

                  ${_(" - End :")} <span class="start_end_date_time">${_(" {end_date}").format(end_date=course_overview.end_datetime_text("SHORT_DATE"))}
                  </span>
                % endif
            % endif
          </span>
        </div>
        <!-- -->
        <!-- -->
        <!-- -->
        <!-- -->
        <!-- -->
        <!-- -->
        <!-- -->
        <!-- -->
        <h3 class="course-title">
          % if show_courseware_link:
            % if not is_course_blocked:
              <a data-course-key="${enrollment.course_id}" href="${course_target}">${course_overview.display_name_with_default}</a>
            % else:
              <a class="disable-look" data-course-key="${enrollment.course_id}">${course_overview.display_name_with_default}</a>
            % endif
          % else:
            <span>${course_overview.display_name_with_default}</span>
          % endif
        </h3>
        <div class="course-info" id="course-info-pop2">
          <span class="info-date-block" data-tooltip="Hi">
            % if course_overview.display_org_with_default == "Vodeclic":
            <p><img src="/static/themes/phileastheming/images/icon_calendar.png" /> Formation permanente</p>
            % else:
            <p><img src="/static/themes/phileastheming/images/icon_calendar.png" /> ${_("Debut : {start_date}").format(start_date=course_overview.start_datetime_text("SHORT_DATE"))}
            </p>
            <p>
              <img src="/static/themes/phileastheming/images/icon_calendar.png" /> ${_(" - Fin : {end_date}").format(end_date=course_overview.end_datetime_text("SHORT_DATE"))}
            </p>
            % endif
          </span>
        </div>
        <p id="text-compl">
          <span>${course_overview.display_org_with_default}</span>
        </p>
      <!--
        <p class="button-option"><button class="button-option-action">options</button></p>
      -->
        <div class="wrapper-action-more social2-on" data-course-key="${enrollment.course_id}">
          % if can_unenroll:
            <div class="actions-item" id="actions-item-unenroll-${dashboard_index}">
              <div class="social-sharing">
                  <a href="mailto:?subject=PhilÃ©as - Suivez%20un%20cours%20en%20ligne%20avec%20Phileas&amp;body=Je%20viens%20de%20m'inscrire%20pour%20${course_overview.display_name_with_default}%20via%20http://ec2-52-29-194-206.eu-central-1.compute.amazonaws.com${course_target}" class="share">
                    <img src="/static/themes/phileastheming/images/icon_recommandation.png" style="width:16px; height: auto; float:left; margin-right: 5px;" />${_("Recommend to a friend")}<span class="sr">${_("Envoyez par e-mail que vous etes inscrits a ce cours")}</span>
                  </a>
              </div>
            % if is_paid_course and show_refund_option:
              % if not is_course_blocked:
              <a href="#unenroll-modal" class="action action-unenroll" rel="leanModal" data-course-id="${course_overview.id}" data-course-number="${course_overview.number}" data-course-name="${course_overview.display_name_with_default}" data-dashboard-index="${dashboard_index}"
                 data-track-info="${_("Are you sure you want to unenroll from the purchased course %(course_name)s (%(course_number)s)?")}"
                 data-refund-info="${_("You will be refunded the amount you paid.")}">
                <img src="/static/themes/phileastheming/images/icon_desinscription.png" style="width:16px; height: auto; float:left; margin-right: 5px"/> ${_("Unenroll")}
              </a>
              % else:
              <a class="action action-unenroll is-disabled" data-course-id="${course_overview.id}" data-course-number="${course_overview.number}" data-course-name="${course_overview.display_name_with_default}" data-dashboard-index="${dashboard_index}"
                 data-track-info="${_("Are you sure you want to unenroll from the purchased course %(course_name)s (%(course_number)s)?")}"
                 data-refund-info="${_("You will be refunded the amount you paid.")}"><img src="/static/themes/phileastheming/images/icon_desinscription.png" style="width:16px; height: auto; float:left; margin-right: 5px"/>
                ${_("Unenroll")}
              </a>
              % endif
            % elif is_paid_course and not show_refund_option:
              % if not is_course_blocked:
              <a href="#unenroll-modal" class="action action-unenroll" rel="leanModal" data-course-id="${course_overview.id}" data-course-number="${course_overview.number}" data-course-name="${course_overview.display_name_with_default}" data-dashboard-index="${dashboard_index}"
                 data-track-info="${_("Are you sure you want to unenroll from the purchased course %(course_name)s (%(course_number)s)?")}"
                 data-refund-info="${_("You will not be refunded the amount you paid.")}"><img src="/static/themes/phileastheming/images/icon_desinscription.png" style="width:16px; height: auto; float:left; margin-right: 5px"/>
                ${_("Unenroll")}
              </a>
              % else:
              <a class="action action-unenroll is-disabled" data-course-id="${course_overview.id}" data-course-number="${course_overview.number}" data-course-name="${course_overview.display_name_with_default}" data-dashboard-index="${dashboard_index}"
                 data-track-info="${_("Are you sure you want to unenroll from the purchased course %(course_name)s (%(course_number)s)?")}"
                 data-refund-info="${_("You will not be refunded the amount you paid.")}"><img src="/static/themes/phileastheming/images/icon_desinscription.png" style="width:16px; height: auto; float:left; margin-right: 5px"/>
                ${_("Unenroll")}
              </a>
              % endif
            % elif enrollment.mode != "verified":
              % if not is_course_blocked:
              <a href="#unenroll-modal" class="action action-unenroll" rel="leanModal" data-course-id="${course_overview.id}" data-course-number="${course_overview.number}" data-course-name="${course_overview.display_name_with_default}" data-dashboard-index="${dashboard_index}"
                 data-track-info="${_("Are you sure you want to unenroll from %(course_name)s (%(course_number)s)?")}"><img src="/static/themes/phileastheming/images/icon_desinscription.png" style="width:16px; height: auto; float:left; margin-right: 5px"/>
                ${_("Unenroll")}
              </a>
              % else:
              <a class="action action-unenroll is-disabled" data-course-id="${course_overview.id}" data-course-number="${course_overview.number}" data-course-name="${course_overview.display_name_with_default}" data-dashboard-index="${dashboard_index}"
                 data-track-info="${_("Are you sure you want to unenroll from %(course_name)s (%(course_number)s)?")}"><img src="/static/themes/phileastheming/images/icon_desinscription.png" style="width:16px; height: auto; float:left; margin-right: 5px"/>
                ${_("Unenroll")}
              </a>
              % endif
            % elif show_refund_option:
              % if not is_course_blocked:
              <a href="#unenroll-modal" class="action action-unenroll" rel="leanModal" data-course-id="${course_overview.id}" data-course-number="${course_overview.number}" data-course-name="${course_overview.display_name_with_default}" data-dashboard-index="${dashboard_index}" data-cert-name-long="${cert_name_long}"
                 data-track-info="${_("Are you sure you want to unenroll from the verified %(cert_name_long)s track of %(course_name)s (%(course_number)s)?")}"
                 data-refund-info="${_("You will be refunded the amount you paid.")}"><img src="/static/themes/phileastheming/images/icon_desinscription.png" style="width:16px; height: auto; float:left; margin-right: 5px"/>
                ${_("Unenroll")}
              </a>
              % else:
              <a class="action action-unenroll is-disabled" data-course-id="${course_overview.id}" data-course-number="${course_overview.number}" data-course-name="${course_overview.display_name_with_default}" data-dashboard-index="${dashboard_index}" data-cert-name-long="${cert_name_long}"
                 data-track-info="${_("Are you sure you want to unenroll from the verified %(cert_name_long)s track of %(course_name)s (%(course_number)s)?")}"
                 data-refund-info="${_("You will be refunded the amount you paid.")}"><img src="/static/themes/phileastheming/images/icon_desinscription.png" style="width:16px; height: auto; float:left; margin-right: 5px"/>
                ${_("Unenroll")}
              </a>
              % endif
            % else:
              % if not is_course_blocked:
              <a href="#unenroll-modal" class="action action-unenroll" rel="leanModal" data-course-id="${course_overview.id}" data-course-number="${course_overview.number}" data-course-name="${course_overview.display_name_with_default}" data-dashboard-index="${dashboard_index}" data-cert-name-long="${cert_name_long}"
                 data-track-info="${_("Are you sure you want to unenroll from the verified %(cert_name_long)s track of %(course_name)s (%(course_number)s)?")}"
                 data-refund-info="${_("The refund deadline for this course has passed, so you will not receive a refund.")}"><img src="/static/themes/phileastheming/images/icon_desinscription.png" style="width:16px; height: auto; float:left; margin-right: 5px"/>
                ${_("Unenroll")}
              </a>
              % else:
              <a class="action action-unenroll is-disabled" data-course-id="${course_overview.id}" data-course-number="${course_overview.number}" data-course-name="${course_overview.display_name_with_default}" data-dashboard-index="${dashboard_index}" data-cert-name-long="${cert_name_long}"
                 data-track-info="${_("Are you sure you want to unenroll from the verified %(cert_name_long)s track of %(course_name)s (%(course_number)s)?")}"
                 data-refund-info="${_("The refund deadline for this course has passed, so you will not receive a refund.")}"><img src="/static/themes/phileastheming/images/icon_desinscription.png" style="width:16px; height: auto; float:left; margin-right: 5px"/>
                ${_("Unenroll")}
              </a>
              % endif
            % endif
          </div>
          % endif
          <div class="actions-item" id="actions-item-email-settings-${dashboard_index}">
            % if show_email_settings:
              % if not is_course_blocked:
                <a href="#email-settings-modal" class="action action-email-settings" rel="leanModal" data-course-id="${course_overview.id}" data-course-number="${course_overview.number}" data-dashboard-index="${dashboard_index}" data-optout="${unicode(course_overview.id) in course_optouts}">${_('Email Settings')}</a>
              % else:
                <a class="action action-email-settings is-disabled" data-course-id="${course_overview.id}" data-course-number="${course_overview.number}" data-dashboard-index="${dashboard_index}" data-optout="${unicode(course_overview.id) in course_optouts}">${_('Email Settings')}</a>
              % endif
            % endif
          </div>
        </div>
        <div class="wrapper-course-actions"  id="counsulter1">
          <div class="course-actions" data-number="${course_number}" data-org="${course_org}">
            % if show_courseware_link:
              % if course_overview.has_ended():
                % if not is_course_blocked:
                  <a href="${course_target}" class="enter-course archived" data-course-key="${enrollment.course_id}">${_('View Archived Course')}<span class="sr">&nbsp;${course_overview.display_name_with_default}</span></a>
                % else:
                  <a class="enter-course-blocked archived" data-course-key="${enrollment.course_id}">${_('View Archived Course')}<span class="sr">&nbsp;${course_overview.display_name_with_default}</span></a>
                % endif
              % else:
                % if not is_course_blocked:
                  <a href="${course_target}" class="enter-course show-dash" data-course-key="${enrollment.course_id}" style="

                  ">${_('show')}<span class="sr">&nbsp;${course_overview.display_name_with_default}</span></a>
                % else:
                  <a class="enter-course-blocked" data-course-key="${enrollment.course_id}">${_('show')}<span class="sr">&nbsp;${course_overview.display_name_with_default}</span></a>
                % endif
              % endif

              % if share_settings:
                <%
                  if share_settings.get("CUSTOM_COURSE_URLS", False):
                    if course_overview.social_sharing_url:
                      share_url = urllib.quote_plus(course_overview.social_sharing_url)
                    else:
                      share_url = ''
                  else:
                    share_url = urllib.quote_plus(request.build_absolute_uri(reverse('about_course', args=[unicode(course_overview.id)])))
                  share_window_name = 'shareWindow'
                  share_window_config = 'toolbar=no, location=no, status=no, menubar=no, scrollbars=yes, resizable=yes, width=640, height=480'
                %>
                % if share_url and share_settings.get('DASHBOARD_FACEBOOK', False):
                  <% facebook_url = 'https://www.facebook.com/sharer/sharer.php?u=' + share_url %>
                    <a
                      data-tooltip="${_('Share on Facebook')}"
                      class="action action-facebook"
                      aria-haspopup="true"
                      aria-expanded="false"
                      href="${facebook_url}"
                      target="_blank"
                      title="${_('Share on Facebook')}"
                      onclick="window.open('${facebook_url}', '${share_window_name}', '${share_window_config}'); return false;">
                      <span class="sr">${_('Facebook')}</span>
                      <i class="fa fa-facebook" aria-hidden="true"></i>
                    </a>
                % endif
                % if share_url and share_settings.get('DASHBOARD_TWITTER', False):
                  <% share_text_default = _("I'm learning on {platform_name}:").format(platform_name=settings.PLATFORM_NAME) %>
                  <% share_text = urllib.quote_plus(share_settings.get('DASHBOARD_TWITTER_TEXT', share_text_default)) %>
                  <% twitter_url = 'https://twitter.com/intent/tweet?text=' + share_text + '%20' + share_url %>
                    <a
                      data-tooltip="${_('Share on Twitter')}"
                      class="action action-twitter"
                      aria-haspopup="true"
                      aria-expanded="false"
                      href="${twitter_url}"
                      target="_blank"
                      title="${_('Share on Twitter')}"
                      onclick="window.open('${twitter_url}', '${share_window_name}', '${share_window_config}'); return false;">
                      <span class="sr">${_('Twitter')}</span>
                      <i class="fa fa-twitter" aria-hidden="true"></i>
                    </a>
                % endif
              % endif
            % endif
          </div>
        </div>
        <div class="wrapper-course-actions" id="counsulter2">
          <div class="course-actions" data-number="${course_number}" data-org="${course_org}">
            % if show_courseware_link:
              % if course_overview.has_ended():
                % if not is_course_blocked:
                  <a href="${course_target}" class="enter-course archived" data-course-key="${enrollment.course_id}">${_('View Archived Course')}<span class="sr">&nbsp;${course_overview.display_name_with_default}</span></a>
                % else:
                  <a class="enter-course-blocked archived" data-course-key="${enrollment.course_id}">${_('View Archived Course')}<span class="sr">&nbsp;${course_overview.display_name_with_default}</span></a>
                % endif
              % else:
                % if not is_course_blocked:
                  <a href="${course_target}" class="enter-course show-dash" data-course-key="${enrollment.course_id}" style="

                  ">${_('show')}<span class="sr">&nbsp;${course_overview.display_name_with_default}</span></a>
                % else:
                  <a class="enter-course-blocked" data-course-key="${enrollment.course_id}">${_('show')}<span class="sr">&nbsp;${course_overview.display_name_with_default}</span></a>
                % endif
              % endif

              % if share_settings:
                <%
                  if share_settings.get("CUSTOM_COURSE_URLS", False):
                    if course_overview.social_sharing_url:
                      share_url = urllib.quote_plus(course_overview.social_sharing_url)
                    else:
                      share_url = ''
                  else:
                    share_url = urllib.quote_plus(request.build_absolute_uri(reverse('about_course', args=[unicode(course_overview.id)])))
                  share_window_name = 'shareWindow'
                  share_window_config = 'toolbar=no, location=no, status=no, menubar=no, scrollbars=yes, resizable=yes, width=640, height=480'
                %>
                % if share_url and share_settings.get('DASHBOARD_FACEBOOK', False):
                  <% facebook_url = 'https://www.facebook.com/sharer/sharer.php?u=' + share_url %>
                    <a
                      data-tooltip="${_('Share on Facebook')}"
                      class="action action-facebook"
                      aria-haspopup="true"
                      aria-expanded="false"
                      href="${facebook_url}"
                      target="_blank"
                      title="${_('Share on Facebook')}"
                      onclick="window.open('${facebook_url}', '${share_window_name}', '${share_window_config}'); return false;">
                      <span class="sr">${_('Facebook')}</span>
                      <i class="fa fa-facebook" aria-hidden="true"></i>
                    </a>
                % endif
                % if share_url and share_settings.get('DASHBOARD_TWITTER', False):
                  <% share_text_default = _("I'm learning on {platform_name}:").format(platform_name=settings.PLATFORM_NAME) %>
                  <% share_text = urllib.quote_plus(share_settings.get('DASHBOARD_TWITTER_TEXT', share_text_default)) %>
                  <% twitter_url = 'https://twitter.com/intent/tweet?text=' + share_text + '%20' + share_url %>
                    <a
                      data-tooltip="${_('Share on Twitter')}"
                      class="action action-twitter"
                      aria-haspopup="true"
                      aria-expanded="false"
                      href="${twitter_url}"
                      target="_blank"
                      title="${_('Share on Twitter')}"
                      onclick="window.open('${twitter_url}', '${share_window_name}', '${share_window_config}'); return false;">
                      <span class="sr">${_('Twitter')}</span>
                      <i class="fa fa-twitter" aria-hidden="true"></i>
                    </a>
                % endif
              % endif
            % endif
          </div>
        </div>
      </div>
  </section>
  <footer class="wrapper-messages-primary">
    <ul class="messages-list">
      % if course_overview.may_certify() and cert_status:
        <%include file='_dashboard_certificate_information.html' args='cert_status=cert_status,course_overview=course_overview, enrollment=enrollment'/>
      % endif

      % if credit_status is not None:
        <%include file="_dashboard_credit_info.html" args="credit_status=credit_status"/>
      % endif

        % if verification_status.get('status') in [VERIFY_STATUS_NEED_TO_VERIFY, VERIFY_STATUS_SUBMITTED, VERIFY_STATUS_APPROVED, VERIFY_STATUS_NEED_TO_REVERIFY] and not is_course_blocked:
        <div class="message message-status wrapper-message-primary is-shown">
          % if verification_status['status'] == VERIFY_STATUS_NEED_TO_VERIFY:
            <div class="verification-reminder">
              % if verification_status['days_until_deadline'] is not None:
                <h4 class="message-title">${_('Verification not yet complete.')}</h4>
                <p class="message-copy">${ungettext(
                  'You only have {days} day left to verify for this course.',
                  'You only have {days} days left to verify for this course.',
                  verification_status['days_until_deadline']
                ).format(days=verification_status['days_until_deadline'])}</p>
              % else:
                <h4 class="message-title">${_('Almost there!')}</h4>
                <p class="message-copy">${_('You still need to verify for this course.')}</p>
              % endif
            </div>
            <div class="verification-cta">
              <a href="${reverse('verify_student_verify_now', kwargs={'course_id': unicode(course_overview.id)})}" class="cta" data-course-id="${course_overview.id}">${_('Verify Now')}</a>
            </div>
          % elif verification_status['status'] == VERIFY_STATUS_SUBMITTED:
            <h4 class="message-title">${_('You have already verified your ID!')}</h4>
            <p class="message-copy">${_('Thanks for your patience as we process your request.')}</p>
          % elif verification_status['status'] == VERIFY_STATUS_APPROVED:
            <h4 class="message-title">${_('You have already verified your ID!')}</h4>
            % if verification_status.get('verification_good_until') is not None:
              <p class="message-copy">${_('Your verification status is good until {date}.').format(date=verification_status['verification_good_until'])}
            % endif
          % elif verification_status['status'] == VERIFY_STATUS_NEED_TO_REVERIFY:
            <h4 class="message-title">${_('Your verification will expire soon!')}</h4>
            ## Translators: start_link and end_link will be replaced with HTML tags;
            ## please do not translate these.
            <p class="message-copy">${Text(_('Your current verification will expire before the verification deadline '
              'for this course. {start_link}Re-verify your identity now{end_link} using a webcam and a '
              'government-issued ID.')).format(
                start_link=HTML('<a href="{href}">').format(href=reverse('verify_student_reverify')),
                end_link=HTML('</a>')
              )}
            </p>
          % endif
        </div>
        % endif

        % if course_mode_info['show_upsell'] and not is_course_blocked:
          <div class="message message-upsell has-actions is-shown">

            <div class="wrapper-extended">
                <p class="message-copy" align="justify">
                  <b class="message-copy-bold">
                    ${_("Pursue a {cert_name_long} to highlight the knowledge and skills you gain in this course.").format(cert_name_long=cert_name_long)}
                  </b><br>
                    ${Text(_("It's official. It's easily shareable. "
                        "It's a proven motivator to complete the course. {line_break}"
                        "{link_start}Learn more about the verified {cert_name_long}{link_end}.")).format(
                          line_break=HTML('<br>'),
                          link_start=HTML('<a href="{}" class="verified-info" data-course-key="{}">').format(
                            marketing_link('WHAT_IS_VERIFIED_CERT'),
                            enrollment.course_id
                          ),
                          link_end=HTML('</a>'),
                          cert_name_long=cert_name_long
                        )}
                </p>
                <div class="action-upgrade-container">
                  % if use_ecommerce_payment_flow and course_mode_info['verified_sku']:
                    <a class="action action-upgrade" href="${ecommerce_payment_page}?sku=${course_mode_info['verified_sku']}">
                  % else:
                    <a class="action action-upgrade" href="${reverse('verify_student_upgrade_and_verify', kwargs={'course_id': unicode(course_overview.id)})}" data-course-id="${course_overview.id}" data-user="${user.username}">
                  % endif
                      <i class="action-upgrade-icon"></i>
                    <span class="wrapper-copy">
                      <span class="copy" id="upgrade-to-verified">${_("Upgrade to Verified")}</span>
                    </span>
                  </a>
                </div>
            </div>
          </div>
        %endif

        % if course_program_info and course_program_info.get('category')=='xseries':
          %for program_data in course_program_info.get('course_program_list', []):
            <%include file = "_dashboard_xseries_info.html" args="program_data=program_data, enrollment_mode=enrollment.mode, display_category=course_program_info['display_category']" />
          %endfor
        % endif

        % if is_course_blocked:
          <p id="block-course-msg" class="course-block">
            ${Text(_("You can no longer access this course because payment has not yet been received. "
                "You can {contact_link_start}contact the account holder{contact_link_end} "
                "to request payment, or you can "
                "{unenroll_link_start}unenroll{unenroll_link_end} "
                "from this course")).format(
              contact_link_start=HTML('<a href="#">'),
              contact_link_end=HTML('</a>'),
              unenroll_link_start=HTML(
                '<a id="unregister_block_course" rel="leanModal" '
                'data-course-id="{course_id}" data-course-number="${course_number}" data-course-name="{course_name}" '
                'href="#unenroll-modal">'
              ).format(
                course_id=course_overview.id,
                course_number=course_overview.number,
                course_name=course_overview.display_name_with_default,
              ),
              unenroll_link_end=HTML('</a>'),
            )}
          </p>
        %endif


        % if course_requirements:
        ## Multiple pre-requisite courses are not supported on frontend that's why we are pulling first element
        <% prc_target = reverse('about_course', args=[unicode(course_requirements['courses'][0]['key'])]) %>
        <li class="prerequisites">
          <p class="tip">
            ${_("You must successfully complete {link_start}{prc_display}{link_end} before you begin this course.").format(
                link_start='<a href="{}">'.format(prc_target),
                link_end='</a>',
                prc_display=course_requirements['courses'][0]['display'],
              )}
          </p>
        </li>
        % endif
    </ul>
  </footer>
</article>
</div>
</li>
<script>
   $( document ).ready(function() {

       if("${is_course_blocked}" == "True"){
           $( "#unregister_block_course" ).click(function() {
               $('.disable-look-unregister').click();
           });
       }
   });
   function popUp() {
     var Id = $('#unenroll-modal');
     var Children = Id.find('.inner-wrapper');
     Id.css('height','auto');
     Id.css('margin-top','-200px');
     Id.css('top','50%');
     Id.css('padding','0');
     Id.css('border','none');
     $('.close-modal').html('');
     $('.close-modal').html('<img src="/static/themes/phileastheming/images/icon_close.png" />');
   }
   function formatPopup() {
     var Id = $('#unenroll-modal');
     if(parseInt($(document).width()) > 550) {
       Id.css('width','50vw');
       Id.css('margin-left','-25vw');
     }else {
       Id.css('width','80vw');
       Id.css('margin-left','-40vw');
     }
   }
   $(document).ready(function(){
     formatPopup();
     $('.action-unenroll').click(function(){
       popUp();
       formatPopup();
     });

   })
   $(window).resize(function(){
     formatPopup()
   })
</script>
<script>
  function AjoutAhrefVide() {
    var Link1 = $('#counsulter1');
    var Link2 = $('#counsulter2');
    var Verif1 = Link1.find('a');
    var Verif2 = Link2.find('a');
    if(Verif2.length == 0) {
      Link2.html('<div class="course-actions" data-number="${course_number}" data-org="${course_org}"><a href="#" class="enter-course show-dash" data-course-key="course-v1:edX+DemoX+Demo_Course" style="">Course Closed<span class="sr">&nbsp;edX Demonstration Course</span></a></div>');
    }
    if(Verif1.length == 0 ) {
      Link1.html('<div class="course-actions" data-course-number="${course_number}" data-org="${course_org}"><a href="#" class="enter-course show-dash" data-course-key="course-v1:edX+DemoX+Demo_Course" style="">Course closed<span class="sr">&nbsp;edX Demonstration Course</span></a></div>');
    }
  }
  $(document).ready(function(){
    AjoutAhrefVide();
  })
</script>
